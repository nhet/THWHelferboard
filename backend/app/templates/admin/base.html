
<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>THEOrganigramm</title>
  <link rel="stylesheet" href="/static/styles.css" />
  <link rel="icon" href="/static/favicon.ico" type="image/x-icon">
  <script src="/static/htmx.min.js"></script>
  <script>
    window.serverReachable = false;

    window.handleUpdate = function(event) {
      const data = JSON.parse(event.detail.xhr.responseText);
      if (window.lastKnown && data.timestamp !== window.lastKnown) {
        window.location.href = "/";
      }
      window.lastKnown = data.timestamp;
      window.serverReachable = true;
    };

    window.handleError = function(event) {
      // ignore errors
      window.serverReachable = false;
    };
  </script>
</head>
<body hx-boost="true">
  <main>
  {% block content %}
    <header class="site-header">
      <h1>Helferboard - Admin</h1>
      <nav>
        <a href="/">Öffentlich</a>
        <a href="/admin">Admin</a>
        <a href="/admin/functions">Funktionen</a>
        <a href="/admin/helpers">Helfer</a>
        <a href="/admin/groups">Gruppen</a>
        <a href="/admin/settings">Einstellungen</a>
      </nav>
    </header>
    {% block admin_content %}{% endblock %}
  {% endblock %}
  </main>
  <script>
    document.addEventListener('paste', function (e) {
      const files = e.clipboardData.files;
      if (files.length > 0) {
        const fileInput = document.querySelector('input[type="file"]');
        if (fileInput) {
          fileInput.files = files;
          const label = fileInput.closest('label');
          if(label) {
            let hint = label.querySelector('.paste-hint');
            if(!hint) {
              hint = document.createElement('span');
              hint.className = 'paste-hint';
              hint.textContent = ' (Bild aus Zwischenablage eingefügt)';
              label.appendChild(hint);
            }
          }
        }
      }
    });
  </script>
  <div id="polling-div" hx-get="/last_update" hx-trigger="every 5s" hx-swap="none"></div>
  <script>
    let lastKnown = null;
    window.serverReachable = false;

    window.handleUpdate = function(event) {
      const data = JSON.parse(event.detail.xhr.responseText);
      if (lastKnown && data.timestamp !== lastKnown) {
        window.location.href = "/";
      }
      lastKnown = data.timestamp;
      window.serverReachable = true;
    };

    window.handleError = function(event) {
      // ignore errors
      window.serverReachable = false;
    };

    document.body.addEventListener('htmx:responseError', function(evt) {      alert('Aktion fehlgeschlagen! Der Server ist möglicherweise nicht erreichbar.');    });
    document.getElementById('polling-div').addEventListener('htmx:afterRequest', window.handleUpdate);
    document.getElementById('polling-div').addEventListener('htmx:responseError', window.handleError);
  </script>
  </body>
</html>