
{% extends 'base.html' %}
{% block content %}
{% if incognito_level >= 2 %}
  {% if carousel_title %}
  <h1 class="carousel-title">{{ carousel_title }}</h1>
  {% endif %}

  {% if carousel_images %}
      <div class="carousel-container-large">
        <div class="carousel-large {% if carousel_images|length == 1 %}single-image{% endif %}">
          {% set total = carousel_images|length %}
          {% for img in carousel_images %}
            <div class="carousel-item-large"
              {% if total > 1 %}
                style="--total-slides: {{ total }}; animation-delay: {{ loop.index0 * 4 }}s;"
              {% endif %}>
              <img class="bg" src="{{ url_for('static', path=img.path) }}" alt="">
              <img class="fg" src="{{ url_for('static', path=img.path) }}" alt="">
            </div>
          {% endfor %}
        </div>
      </div>
 {% endif %}


{% endif %}
{% if incognito_level < 2 %}
<div class="public-page">
  <div class="legende">
  <span class="legend-title">Legende:</span>
  {% for func in allFunctionsInUse %}
    {% if func.emblem_svg_path %}
      <div class="legend-item">
        <img height="25px"
             src="{{ url_for('static', path=func.emblem_svg_path) }}"
             alt="Dienststellungskennzeichen-{{ func.short_name }}">
        <span class="legend-text">{{ func.legend_name }}</span>
      </div>
    {% endif %}
  {% endfor %}
</div>

  {% for node in tree %}
    <div class="group-section" style="--indent: 0px">
      <h2 class="group-title">{{ node.group.name }} ({{node.helpers|length}})</h2>
      <div class="helper-grid">
        {% for h in node.helpers %}
          <div class="helper-card">
            <div class="helper-photo">
              {% if h.photo_path %}
                <img src="{{ url_for('static', path=h.photo_path) }}" alt="{{h.first_name}} {{h.last_name}}" />
              {% else %}
                <img src="{{ url_for('static', path='placeholder-photo.svg') }}" alt="Platzhalter" />
              {% endif %}
            </div>
            <div class="helper-name fn">
              {% if incognito_level >= 1 %}
                {{ h.first_name[0] }}.
              {% else %}
                {{ h.first_name }}
              {% endif %}
            </div>
            <div class="helper-name ln">
              {% if incognito_level >= 1 %}
                {{ h.last_name[0] }}.
              {% else %}
                {{ h.last_name }}
              {% endif %}
            </div>
            <div class="helper-emblem">
              {% if h.main_function and h.main_function.emblem_svg_path %}
                <img src="{{ url_for('static', path=h.main_function.emblem_svg_path) }}" alt="Dienststellungskennzeichen-{{ h.main_function.name }}" />
              {% else %}
                <span class="no-emblem">â€“</span>
              {% endif %}
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
  {% endfor %}
</div>
{% endif %}
{% if incognito_level < 2 %}
<script>
  // Horizontal group sliders
  document.addEventListener('DOMContentLoaded', () => {
    const scrollableGrids = Array.from(document.querySelectorAll('.helper-grid')).filter(grid => grid.children.length > 9);

    if (scrollableGrids.length > 0) {
      let scrollingForward = true;
      let cycleCount = 0;
      const hScrollSpeed = 1;
      const hScrollInterval = 30;

      setTimeout(() => {
        function synchronizedHorizontalScroll() {
          if (scrollingForward) {
            const canScrollForward = scrollableGrids.some(
              grid => grid.scrollLeft < grid.scrollWidth - grid.clientWidth - 1
            );

            if (canScrollForward) {
              scrollableGrids.forEach(grid => {
                grid.scrollLeft += hScrollSpeed;
              });
            } else {
              setTimeout(() => {
                scrollingForward = false;
              }, 5000);
            }
          } else {
            const canScrollBackward = scrollableGrids.some(
              grid => grid.scrollLeft > 1
            );

            if (canScrollBackward) {
              scrollableGrids.forEach(grid => {
                grid.scrollLeft -= hScrollSpeed;
              });
            } else {
              setTimeout(() => {
                scrollingForward = true;
                cycleCount++;

                if (cycleCount >= 2) {
                  switchPage();
                  return;
                }
              }, 5000);
            }
          }
        }

        const intervalId = setInterval(synchronizedHorizontalScroll, hScrollInterval);
      }, 5000);
    } else {
      setTimeout(switchPage, 30000);
    }
  });
</script>
{% endif %}
{% if detail_groups %}
{% set pages_list = ["/"] %}
{% for g in detail_groups %}
{% do pages_list.append("/group/" + g.id|string) %}
{% endfor %}
<script>
  const pages = {{ pages_list | tojson | safe }};
  let currentIndex = 0;

  function switchPage() {
    if (window.serverReachable && pages.length > 1){
      currentIndex = (currentIndex + 1) % pages.length;
      window.location.href = pages[currentIndex];
    }
  }

  window.addEventListener('sliderCycleComplete', () => {
    setTimeout(switchPage, 5000);
  });
  window.addEventListener('noSliders', () => {
    setTimeout(switchPage, 5000);
  });
</script>
{% endif %}
{% endblock %}
